wUDEHdczflcZI65x
mongosh "mongodb+srv://cluster0.jf2m2.mongodb.net/" --apiVersion 1 --username muratvuranok


mongodb+srv://muratvuranok:wUDEHdczflcZI65x@cluster0.jf2m2.mongodb.net/



Son 10 yıl içerisinde (2014 sonrası) yapılmış filmleri ve bu filmlere ait olan yorumların listelenmesi


1. section -> $match   : filtreleme
2. section -> $lookup  : join
3. section -> $project : output

[
    {
        $match: {
            year: {
                $gte: 2014
            }
        }
    },
    {
        $lookup: {
 
            /*
                from         -> target collection(table)
                localField   -> local join field
                foreignField -> target join field
                as           -> name for the result
            */

            from: "comments",
            localField: "_id",
            foreignField: "movie_id",
            as: "movie_comments"
        }
    },
    {
        $project: {
                title: 1,
                year: 1,
                _id: 0,
                "movie_comments.text": 1,
                "movie_comments.email": 1
        }
    }
]

Kategorisi Western olan filmlerin ortalama süresi nedir?


[
    {
        $match: {
            year: { $gte: 2014 },
            genres: "Western"  // birden fazla anahtar kelime yer alacak ise, in kullanabilirsiniz
            // genres: { $in: ["Western", "Drama"] }
        },
        {
            $lookup:{
                from: "comments",
                localField: "_id",
                foreignField: "movie_id",
                as: "movie_comments"
            }
        },
        {
            $group:{
                _id: null,
                averageDurationTime: { $avg : "$runtime" },// runtime alanına göre ortalamasını hesaplar
                movies: { $push: "$$ROOT" } // Tüm belgeleri saklar, $push opersatörü, MongoDB'nin $group aşamasındaki bir group içerisinde yer alan değerlerin bir listesini oluşturmak için kullanılır. $$ROOT ise, mevcut belgenin tamamını ifade eder. Yani $push: "$$ROOT" ifadesi, her belgeyi olduğu gibi bir diziye ekler
            }
        },
        {
            $project: {   
                _id: 0,
                averageDurationTime: 1,
                movies: { 
                    title: 1,
                    genres: 1,
                    year: 1,
                    runtime: 1,
                    "movie_comments.text": 1
                }
            }
        }
    }
]